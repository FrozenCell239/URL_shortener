{% extends 'base.html.jinja' %}
{% block main %}
{% if links.items == [] %}
<p>Vous n'avez aucun {{ "raccourci" if type == 'links' else "fichier" }} pour le moment.</p>
{% else %}
    {% if type == 'links' %}
        {% set toggle_message = "Êtes-vous sûr(e) de vouloir désactiver/réactiver ce raccourci ?" %}
        {% set delete_message = "Êtes-vous sûr(e) de vouloir supprimer ce raccourci ? Cette action est irréversible !" %}
    {% else %}
        {% set toggle_message = "Êtes-vous sûr(e) de vouloir désactiver/réactiver le lien de téléchargement de ce fichier ?" %}
        {% set delete_message = "Êtes-vous sûr(e) de vouloir supprimer ce fichier et son lien de téléchargement ? Cette action est irréversible !" %}
        {% set domain_name = domain_name ~ "dl/" %}
    {% endif %}
{% set back_to_page = links.page %}
{% if links.items|length == 1 %}
    {% set back_to_page = back_to_page - 1 %}
{% endif %}
<table>
    <thead>
        <tr>
            <th class="th-short">Raccourci</th>
            <th class="th-clicks">Nombre de clics</th>
            <th class="th-state">Statut</th>
            <th class="th-original">{{ "Lien original" if type == 'links' else "Nom du fichier" }}</th>
            <th class="th-date">Créé le</th>
            <th class="th-last-visit">Dernière visite</th>
            <th class="th-actions">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for link in links %}
        <tr>
            <td class="td-short"><a href='{{ domain_name ~ link.short }}'>{{ domain_name ~ link.short }}</a></td>
            <td class="td-clicks">{{ link.clicks }}</td>
            <td class="td-state">{{ "Actif" if link.state else "Désactivé" }}</td>
            <td class="td-original">
                {{ "<a href=\"" ~ link.original ~ "\">" if link. original else "" }}
                {{ link.original or link.attached_file_name }}
                {{ "</a>" if link. original else "" }}
            </td>
            <td class="td-date">{{ links_dates[loop.index0].date ~ ", " ~ links_dates[loop.index0].time[:-3] }}</td>
            <td class="td-last-visit">
                {{ link.last_visit_at[:10] ~ ", " ~ link.last_visit_at[10:-16] if link.clicks != 0 else "/" }}
            </td>
            <td class="td-actions">
                <a
                    href="#"
                    onclick="openDialog('/u/{{ type }}/{{ link.id }}/toggle?back_to={{ back_to_page }}', '{{ toggle_message }}')"
                >
                    {{ "Désactiver" if link.state else "Réactiver" }}
                </a>
                <a
                    href="#"
                    onclick="openDialog('/u/{{ type }}/{{ link.id }}/delete?back_to={{ back_to_page }}', '{{ delete_message }}')"
                    class="delete-action"
                >
                    Supprimer
                </a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% if links.pages > 1 %}
    {% with pagination_infos = {'pagination' : links, 'pagination_for' : type} %}
        {% include "./_partials/_pagination.html.jinja" %}
    {% endwith %}
{% endif %}
{% include './_partials/_dialog.html.jinja' %}
{% endif %}
{% endblock %}